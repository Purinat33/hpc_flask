<!-- templates/account/password.html -->
{% extends "base.html" %}
{% block title %}Change Password{% endblock %}

{% block content %}
<h1>Change Password</h1>

<div class="card" style="max-width:560px">
    <form method="post" action="{{ url_for('auth.change_password_submit') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <!-- keep this so password managers know the account -->
        <input type="text" name="username" value="{{ current_user.username }}" autocomplete="username"
            aria-hidden="true" tabindex="-1"
            style="position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden;" readonly>

        <label for="current_password">Current password</label>
        <input id="current_password" name="current_password" type="password" required autocomplete="current-password">

        <label for="new_password">New password</label>
        <input id="new_password" name="new_password" type="password" minlength="8" required autocomplete="new-password">

        <label for="new_password2">Confirm new password</label>
        <input id="new_password2" name="new_password2" type="password" minlength="8" required
            autocomplete="new-password">

        <div class="auth-actions">
            <button type="submit" class="auth-login-btn">Update Password</button>
            {% if message %}
            <span id="pw-msg" class="{{ tone }}" aria-live="polite">{{ message }}</span>
            {% endif %}
        </div>
    </form>
    <p class="muted" style="margin-top:.5rem">Minimum 8 characters. Avoid reusing old passwords.</p>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const chk = document.getElementById('togglePw');
        const ids = ['current_password', 'new_password', 'new_password2'];
        chk?.addEventListener('change', () => {
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.type = chk.checked ? 'text' : 'password';
            });
        });
    });
</script>
{% endblock %}
