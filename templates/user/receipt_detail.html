{% extends "base.html" %}
{% block title %}Receipt Detail{% endblock %}

{% block content %}
<h2>Receipt #{{ r['id'] }} — {{ r['status'] }}</h2>
<p>Period: {{ r['start'] }} → {{ r['end'] }}</p>
<p>Total: ฿{{ '%.2f'|format(r['total']) }}</p>

{# --- ACTIONS MOVED TO TOP --- #}
<div class="toolbar" style="margin: .5rem 0;">
    {% if r['status'] == 'pending' and is_owner %}
    <form method="get" action="{{ url_for('payments.start_receipt_payment', rid=r['id']) }}" style="display:inline;">
        <button type="submit">Pay now</button>
    </form>
    {% elif r['status'] == 'pending' and not is_owner %}
    <p class="muted" style="display:inline-block;margin:0 0 0 .25rem;">
        Only the receipt owner can start payment.
    </p>
    {% endif %}

    {% if r['status'] == 'paid' %}
    <p class="muted" style="display:inline-block;margin:0 0 0 .5rem;">
        Paid at {{ r['paid_at']|dt_local or '—' }}
        {% if r['method'] %} • Method: <code>{{ r['method'] }}</code>{% endif %}
        {% if r['tx_ref'] %} • Ref: <code>{{ r['tx_ref'] }}</code>{% endif %}
    </p>
    {% endif %}
</div>

<table>
    <thead>
        <tr>
            <th>Job</th>
            <th>CPU hrs</th>
            <th>GPU hrs</th>
            <th>Mem GB-hrs</th>
            <th>Cost (฿)</th>
        </tr>
    </thead>
    <tbody>
        {% for it in rows %}
        <tr>
            <td>{{ it['job_id_display'] }}</td>
            <td>{{ '%.2f'|format(it['cpu_core_hours']) }}</td>
            <td>{{ '%.2f'|format(it['gpu_hours']) }}</td>
            <td>{{ '%.2f'|format(it['mem_gb_hours']) }}</td>
            <td>{{ '%.2f'|format(it['cost']) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
