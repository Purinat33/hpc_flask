{% extends "base.html" %}
{% block title %}Receipt{% endblock %}

{% block content %}
<h2>My Receipts</h2>
<div class="card">
    {% if receipts %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Period</th>
                <th>Status</th>
                <th>Total (฿)</th>
                <th>Created</th>
            </tr>
        </thead>
        <tbody>
            {% for r in receipts %}
            <tr>
                <td><a href="{{ url_for('user.view_receipt', rid=r['id']) }}">#{{ r['id'] }}</a></td>
                <td>{{ r['start']|dt_local }} → {{ r['end']|dt_local }}</td>
                <td>{{ r['status'] }}</td>
                <td>
                    ฿{{ '%.2f'|format(r.get('total', 0)) }}
                    {% if r.get('tax_amount', 0) > 0 %}
                    <div class="muted" style="font-size:.85em">
                        = ฿{{ '%.2f'|format(r.get('subtotal', 0)) }}
                        + {{ r.get('tax_label','VAT') }}
                        {{ '%.2f'|format(r.get('tax_rate', 0)) }}%
                        (฿{{ '%.2f'|format(r.get('tax_amount', 0)) }})
                    </div>
                    {% endif %}
                </td>
                <td>{{ r['created_at']|dt_local }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="muted">No receipts yet.</p>
    {% endif %}
</div>
{% endblock %}
