{% extends "base.html" %}
{% block title %}Forum{% endblock %}
{% block content %}
{% macro name_with_admin(name) -%}
{{ name }}{% if name in page_admin_usernames %} <b>(Admin)</b>{% endif %}
{%- endmacro %}
<h2 class="page-title">Forum</h2>
<p><a class="btn" href="{{ url_for('forum.thread_new_form') }}"><button>New Thread</button></a></p>

<ul class="forum-list">
    {% for t in threads %}
    <li>
        {% if t.is_pinned %}ðŸ“Œ{% endif %}
        <a href="{{ url_for('forum.thread_view', thread_id=t.id) }}">{{ t.title }}</a>
        <small>by {{ name_with_admin(t.author_username) }} Â· {{ t.created_at|dt_local }}</small>

        {% if current_user.is_authenticated and current_user.role == 'admin' and not t.is_deleted %}
        <form method="post"
            action="{{ url_for('forum.thread_unpin' if t.is_pinned else 'forum.thread_pin', thread_id=t.id) }}"
            style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-sm">{{ 'Unpin' if t.is_pinned else 'Pin' }}</button>
        </form>
        {% endif %}
    </li>
    {% else %}
    <li>No threads yet.</li>
    {% endfor %}
</ul>


<!-- (Optional) pagination controls -->
{% endblock %}
